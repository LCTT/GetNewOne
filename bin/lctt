#!/bin/bash

# exit on exceptions.
set -e

export APP_NAME='lctt'

# save LCTT TranslateProject directory and cd to lctt-cli project root.
export LCTT_DIR="$(pwd)"
cd "$(dirname "$(readlink -f "$0")")"/..

# source library files.
source ./lib/common/error.sh
source ./lib/common/check_deps.sh

# check dependencies.
check_deps git curl || {
  for DEP in $MISSING_DEPS; do
    error "Command \`${DEP}\` is required but not found."
  done
  exit 1
}

# FIXME: refactor with yml.
usage() {
  echo "LCTT Helper"
  echo "Usage: $0 COMMAND [OPTION...]"
  echo
  echo "Commands:"
  echo "  list      List LCTT articles"
  echo "  claim     Claim an article"
  echo "  submit    Submit an claimed article"
  echo "  help      Print usage for commands"
}

# first argument COMMAND is mandatory, or print usage and exit otherwise.
[ $# -lt 1 ] && {
  usage
  exit 1
}

# parse arguments.
COMMAND="$1"
COMMAND_SCRIPT="./lib/commands/${COMMAND}"

# run command if exists, or print error and usage then exit otherwise.
[ -x "$COMMAND_SCRIPT" ] && "$COMMAND_SCRIPT" ${@:2} || {
  error "Unknown command $COMMAND."
  usage
  exit 1
}
